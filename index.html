<!DOCTYPE html>
<html lang="th">
<head>
    <link rel="stylesheet" href="Allearn_header.css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    </script>

    <title>Allearn</title>

    <style>
        :root {
            --primary-blue: #1f3c88;
            --secondary-blue: #4a7599;
            --accent-yellow: #f7d046;
            --soft-yellow: #fff9e6;
            --bg-gray: #f5f7fa;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        body {
            background: var(--bg-gray);
            font-family: 'Kanit', sans-serif;
            background-image: linear-gradient(#e0e7ef 1px, transparent 1px);
            background-size: 100% 40px;
            margin: 0;
            overflow-x: hidden;
        }

        /* Hero Section - Multiplatform Responsive */
        .hero {
            display: flex;
            padding: 60px 5%;
            justify-content: center;
            align-items: center;
            max-width: 1200px;
            margin: auto;
            gap: 40px;
            min-height: 60vh;
        }

        .hero-content-box {
            background-color: var(--soft-yellow);
            padding: 40px;
            border-radius: 30px;
            flex: 1;
            box-shadow: var(--shadow);
        }

        .hero-content-box h1 { 
            font-size: clamp(28px, 4vw, 42px); 
            color: var(--primary-blue); 
            margin-top: 0; 
            line-height: 1.2;
        }
        .hero-content-box p { 
            font-size: clamp(16px, 2vw, 18px); 
            color: var(--secondary-blue); 
            margin-bottom: 30px;
        }

        .hero-img-only { 
            flex: 0.8; 
            display: flex;
            justify-content: center;
        }
        .hero-img-only img {
            width: 100%;
            max-width: 450px;
            border-radius: 20px;
            filter: drop-shadow(0 15px 25px rgba(0,0,0,0.15));
            object-fit: cover;
        }

        .btn-action {
            display: inline-block;
            padding: 14px 32px;
            background: var(--accent-yellow);
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            color: var(--primary-blue);
            transition: all 0.3s ease;
            text-align: center;
            border: none;
        }
        .btn-action:hover { 
            background: #eec220; 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(247, 208, 70, 0.4);
        }

        /* Content Section */
        .content-white {
            background: var(--white);
            padding: 60px 5%;
            border-radius: 50px 50px 0 0;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.03);
            margin-top: 40px;
        }

        .section-title {
            text-align: center;
            color: var(--primary-blue);
            margin-bottom: 40px;
            font-size: clamp(24px, 3vw, 32px);
            font-weight: 600;
        }

        /* Sheet Grid - Flexible Layout */
        .sheet-section { max-width: 1200px; margin: auto; margin-bottom: 60px; }
        .sheet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .sheet-card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            border: 1px solid #eee;
        }
        .sheet-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 12px 25px rgba(0,0,0,0.1); 
        }
        .sheet-thumb { height: 180px; background: #eceff4; overflow: hidden; }
        .sheet-thumb img { width: 100%; height: 100%; object-fit: cover; }
        
        .sheet-body { padding: 20px; flex-grow: 1; }
        .sheet-tag {
            display: inline-block;
            background: var(--accent-yellow);
            color: var(--primary-blue);
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 12px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .sheet-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }
        .sheet-body h3 { font-size: 16px; margin: 0; color: var(--primary-blue); line-height: 1.5; }
        .sheet-fav-count {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #ff4757;
            font-weight: 600;
        }

        /* Professor Section - Scrolling Fix */
        .professor-section { max-width: 1200px; margin: auto; }
        .professor-scroll {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 20px 5px;
            scrollbar-width: none; /* Hide for Firefox */
            -ms-overflow-style: none; /* Hide for IE */
        }
        .professor-scroll::-webkit-scrollbar { display: none; } /* Hide for Chrome/Safari */
        
        .professor-card {
            width: 200px;
            background: var(--white);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: 0.3s;
            flex-shrink: 0;
            border: 1px solid #f0f0f0;
        }
        .professor-card:hover { transform: translateY(-5px); border-color: var(--accent-yellow); }
        .professor-card img { 
            width: 100px; 
            height: 100px; 
            border-radius: 50%; 
            object-fit: cover; 
            margin-bottom: 15px; 
            border: 3px solid var(--accent-yellow);
        }
        .professor-card h3 { 
            font-size: 15px; 
            color: var(--primary-blue); 
            margin: 0; 
            line-height: 1.4;
        }

        /* Footer */
        .footer { 
            background: #1a1a1a; 
            color: #d1d1d1; 
            padding: 60px 10%; 
            margin-top: 60px; 
        }
        .footer h2 { color: var(--white); margin-bottom: 20px; font-size: 24px; }
        .footer p { line-height: 1.8; font-size: 14px; }

        /* Responsive Breakpoints */
        @media (max-width: 992px) {
            .hero { flex-direction: column; text-align: center; padding-top: 40px; }
            .hero-content-box { width: 100%; order: 2; }
            .hero-img-only { width: 100%; order: 1; }
            .hero-img-only img { max-width: 300px; }
        }

        @media (max-width: 600px) {
            .content-white { padding: 40px 15px; border-radius: 30px 30px 0 0; }
            .sheet-grid { grid-template-columns: 1fr; }
            .hero-content-box { padding: 30px 20px; }
        }
    </style>
</head>

<body>

<div id="header"></div>

<section class="hero">
    <div class="hero-content-box">
        <h1>เพื่อนยามยากที่จะพาเราเรียนเข้าใจทุกบทเรียน</h1>
        <p>แหล่งรวมเอกสารประกอบการเรียนและสรุปบทเรียน สำหรับนักศึกษาคณะวิทยาศาสตร์และเทคโนโลยี มหาวิทยาลัยเทคโนโลยีราชมงคลพระนคร</p>
        <a href="Allearn_login.html" class="btn-action" id="heroBtn">เริ่มต้นใช้งานระบบ</a>
    </div>
    <div class="hero-img-only">
        <img src="pepstudy.jpg" alt="การเรียนรู้ของนักศึกษา">
    </div>
</section>

<div class="content-white">
    <h2 class="section-title">เอกสารการเรียนที่ได้รับความนิยมล่าสุด</h2>
    <section class="sheet-section">
        <div class="sheet-grid" id="sheetGrid">
            <p style="text-align:center; grid-column: 1/-1; color: #888;">กำลังดำเนินการเรียกข้อมูล...</p>
        </div>
    </section>

    <section class="professor-section">
        <h2 class="section-title">คณาจารย์ประจำคณะวิทยาศาสตร์และเทคโนโลยี</h2>
        <div class="professor-scroll" id="professorScroll"></div>
    </section>
</div>

<footer class="footer">
    <div style="max-width: 1200px; margin: auto;">
        <h2>ข้อมูลการติดต่อ</h2>
        <p>คณะวิทยาศาสตร์และเทคโนโลยี มหาวิทยาลัยเทคโนโลยีราชมงคลพระนคร (ศูนย์พระนครเหนือ)<br>
           1381 ถนนประชาราษฎร์ 1 แขวงวงศ์สว่าง เขตบางซื่อ กรุงเทพมหานคร 10800<br>
           โทรศัพท์ : 02-836-3000 ต่อ 4194, 4155</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const supabaseClient = supabase.createClient(
        'https://ctfrqwehpvpldtiojedb.supabase.co',
        'sb_publishable_YHDQnG7VsNgb4O4i6MPN5g_lgU5eOGI'
    );

    // Load Header
    fetch("Allearn_header.html")
        .then(res => res.text())
        .then(data => {
            document.getElementById("header").innerHTML = data;
            initSearchDropdown();
        });

    function initSearchDropdown() {
        const sInput = document.getElementById('headerSearchInput');
        const sDropdown = document.getElementById('headerSearchDropdown');
        if (!sInput) return;
        sInput.addEventListener('focus', () => { sDropdown.classList.add('show'); loadSearchQuickTags(); });
        document.addEventListener('click', (e) => { if (!e.target.closest('.search-container')) sDropdown.classList.remove('show'); });
    }

    async function loadSearchQuickTags() {
        const subList = document.getElementById('searchSubjectList');
        const profList = document.getElementById('searchProfessorList');
        try {
            const [{ data: subjects }, { data: professors }] = await Promise.all([
    supabaseClient.from("Subject").select("idsubject, subject_name, idyear").limit(10),
    supabaseClient.from("Professor")
        .select("idprofessor, name")
        .order("idprofessor", { ascending: true })
        .limit(10) // เอาแค่ 10 คนแรก (P01-P10)
]);
            if (subjects && subList) subList.innerHTML = subjects.map(s => `<a href="Allearn_years.html?idyear=${s.idyear}&target_sub=${s.idsubject}" class="search-tag-link">${s.subject_name}</a>`).join('');
            if (professors && profList) profList.innerHTML = professors.map(p => `<a href="Allearn_professor.html?id=${p.idprofessor}" class="search-tag-link">${p.name}</a>`).join('');
        } catch (err) {}
    }

    async function loadLatestSheets() {
        const grid = document.getElementById("sheetGrid");
        const { data, error } = await supabaseClient
            .from("Sheet")
            .select(`
                idsheet,
                sheet_name,
                sheet_cover,
                idsubject,
                Subject:idsubject (subject_name),
                favsheet(count)
            `)
            .order("created_at", { ascending: false })
            .limit(6);

        if (error) {
            grid.innerHTML = "<p style='text-align:center;'>ขออภัย ไม่สามารถโหลดข้อมูลได้ในขณะนี้</p>";
            return;
        }

        grid.innerHTML = data.map(s => {
            const likeCount = s.favsheet?.[0]?.count || 0;
            return `
                <a href="Allearn_content.html?idsheet=${s.idsheet}" class="sheet-card">
                    <div class="sheet-thumb">
                        <img src="${s.sheet_cover || 'Exsheet.png'}" onerror="this.src='Exsheet.png'" alt="${s.sheet_name}">
                    </div>
                    <div class="sheet-body">
                        <span class="sheet-tag">${s.Subject?.subject_name || 'ทั่วไป'}</span>
                        <div class="sheet-title-row">
                            <h3>${s.sheet_name}</h3>
                            <div class="sheet-fav-count">
                                <i class="fa-solid fa-heart"></i>
                                <span>${likeCount}</span>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }).join("");
    }

    async function loadProfessor() {
        const scroll = document.getElementById("professorScroll");
        const { data, error } = await supabaseClient
            .from("Professor")
            .select("idprofessor, name, surname, img_professor")
            .order("idprofessor", { ascending: true });

        if (error) return;
        
        if (data) {
            scroll.innerHTML = data.map(p => `
                <a href="Allearn_professor.html?id=${p.idprofessor}" style="text-decoration:none; color:inherit; flex-shrink:0;">
                    <div class="professor-card">
                        <img src="${p.img_professor || 'img/professor-default.jpg'}" onerror="this.src='img/professor-default.jpg'" alt="${p.name}">
                        <h3>${p.name}<br>${p.surname}</h3>
                    </div>
                </a>
            `).join('');
        }
    }

    loadLatestSheets();
    loadProfessor();
</script>

<script type="module">
    const idacc = sessionStorage.getItem("idacc");
    const heroBtn = document.getElementById("heroBtn");
    if (idacc && heroBtn) heroBtn.style.display = "none";
</script>

</body>
</html>