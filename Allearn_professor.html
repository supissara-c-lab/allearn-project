<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="Allearn_header.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<title>Allearn - อาจารย์</title>

<style>
body {
  font-family: 'Kanit', sans-serif;
  background:#f5f7fa;
  margin:0;
  background-image: linear-gradient(#e0e7ef 1px, transparent 1px);
  background-size: 100% 40px;
}

/* ===== PROFESSOR CARD AREA ===== */
.professor-container {
  max-width: 1100px;
  margin: 40px auto;
  padding: 0 20px;
}

.professor-card-main {
  display: flex;
  gap: 50px;
  padding: 45px;
  background: #fff;
  border-radius: 40px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.05);
  align-items: center;
}

.professor-left img {
  width: 260px;
  height: 330px;
  object-fit: cover;
  border-radius: 25px;
  background: #eee;
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  border: 4px solid #f7d046; 
}

.info {
  flex: 1;
}

.prof-name-th { font-size: 34px; color: #1f3c88; margin: 0; font-weight: 600; }
.prof-name-en { font-size: 18px; color: #666; margin-bottom: 8px; }

.prof-email { 
  font-size: 15px; 
  color: #777; 
  margin-bottom: 20px; 
  display: flex;
  align-items: center;
  gap: 8px;
}

.material-symbols-outlined {
  font-size: 20px;
  vertical-align: middle;
  color: #888; 
}

.info h4 {
  margin: 20px 0 10px 0;
  color: #1f3c88;
  font-size: 17px;
  font-weight: 500;
}

/* Tag Styles */
.tag {
  padding: 7px 18px;
  border-radius: 20px;
  font-size: 13px;
  display: inline-block;
  margin: 4px 8px 4px 0;
  transition: 0.3s;
  font-weight: 500;
  text-decoration: none;
}
.tag:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
.blue { background: #2f6bff; color: #fff; }
.yellow { background: #f7d046; color: #000; }

/* ===== OTHER PROFESSORS (แก้ไข: ขนาดเท่ากัน และเอากรอบเหลืองตอนชี้ออก) ===== */
.professor-section {
  max-width: 1100px;
  margin: 40px auto;
  padding: 50px 20px;
}

.professor-title {
  text-align: center;
  color: #1f3c88;
  margin-bottom: 40px;
  font-size: 28px;
}

.professor-scroll {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  padding: 20px 10px;
  scrollbar-width: thin;
}

.professor-scroll::-webkit-scrollbar { height: 6px; }
.professor-scroll::-webkit-scrollbar-thumb { background: #f7d046; border-radius: 10px; }

.professor-card-small {
  width: 220px; /* ความกว้างคงที่ */
  min-height: 280px; /* ความสูงขั้นต่ำคงที่ */
  background: white;
  border-radius: 25px;
  padding: 25px 15px;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
  transition: 0.3s;
  border: 1px solid #eee; /* กรอบปกติสีเทาอ่อน */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  flex-shrink: 0;
}

.professor-card-small:hover { 
  transform: translateY(-8px); 
  box-shadow: 0 12px 25px rgba(0,0,0,0.1); 
  /* ลบ border-color: #f7d046; ออกแล้วเพื่อให้ไม่มีกรอบเหลืองตอนชี้ */
}

.professor-card-small img { 
  width: 120px; 
  height: 120px; 
  border-radius: 50%; 
  object-fit: cover; 
  margin-bottom: 20px; 
  border: 3px solid #f7d046; 
  flex-shrink: 0;
}

.professor-card-small h3 { 
  font-size: 17px; 
  margin: 0; 
  color: #1f3c88; 
  line-height: 1.4;
  width: 100%;
  word-wrap: break-word;
}

.professor-link { 
  text-decoration: none; 
  color: inherit; 
  flex-shrink: 0; 
}
</style>
</head>

<body>

<div id="header"></div>

<div class="professor-container">
  <section class="professor-card-main">
    <div class="professor-left">
      <img id="profileImg" src="img/professor-default.jpg" onerror="this.src='img/professor-default.jpg'">
    </div>
    
    <div class="info">
      <h1 class="prof-name-th" id="nameTH">กำลังโหลด...</h1>
      <div class="prof-name-en" id="nameEN"></div>
      
      <div class="prof-email" id="emailContainer">
        <span class="material-symbols-outlined">mail</span>
        <span id="email">กำลังโหลด...</span>
      </div>

      <h4>อาจารย์ประจำสาขา</h4>
      <div id="majorTagContainer">
          <span class="tag blue" id="major">กำลังโหลด...</span>
      </div>

      <h4>วิชาที่สอน</h4>
      <div id="subjects"></div>
    </div>
  </section>
</div>

<section class="professor-section">
  <h2 class="professor-title">อาจารย์ท่านอื่น</h2>
  <div class="professor-scroll" id="otherProfessorScroll"></div>
</section>

<script>
const supabaseClient = supabase.createClient(
  "https://ctfrqwehpvpldtiojedb.supabase.co",
  "sb_publishable_YHDQnG7VsNgb4O4i6MPN5g_lgU5eOGI"
)

const idprofessor = new URLSearchParams(window.location.search).get("id")

/* ===== 1. HEADER & SEARCH ===== */
fetch("Allearn_header.html")
  .then(res => res.text())
  .then(data => {
    document.getElementById("header").innerHTML = data;
    initSearchDropdown();
  });

function initSearchDropdown() {
    const sInput = document.getElementById('headerSearchInput');
    const sDropdown = document.getElementById('headerSearchDropdown');
    if (!sInput) return;
    sInput.addEventListener('focus', () => {
        sDropdown.classList.add('show');
        loadSearchQuickTags();
    });
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-container')) {
            sDropdown.classList.remove('show');
        }
    });
}

async function loadSearchQuickTags() {
    const subList = document.getElementById('searchSubjectList');
    const profList = document.getElementById('searchProfessorList');
    try {
        const [{ data: subjects }, { data: professors }] = await Promise.all([
            supabaseClient.from("Subject").select("idsubject, subject_name, idyear").limit(8),
            supabaseClient.from("Professor").select("idprofessor, name").limit(8)
        ]);
        if (subjects && subList) {
            subList.innerHTML = subjects.map(s => 
                `<a href="Allearn_years.html?idyear=${s.idyear}&target_sub=${s.idsubject}" class="search-tag-link">${s.subject_name}</a>`
            ).join('');
        }
        if (professors && profList) {
            profList.innerHTML = professors.map(p => 
                `<a href="Allearn_professor.html?id=${p.idprofessor}" class="search-tag-link">${p.name}</a>`
            ).join('');
        }
    } catch (err) { console.error(err); }
}

/* ===== 2. LOAD DATA ===== */
if(idprofessor) {
    loadProfessor();
}

async function loadProfessor(){
  const { data:prof, error } = await supabaseClient
    .from("Professor")
    .select(`
      idprofessor, name, surname, Eng_name, professor_email, img_professor,
      Major ( major_name )
    `)
    .eq("idprofessor", idprofessor)
    .single();

  if(error) return console.error(error);

  document.getElementById("nameTH").textContent = `${prof.name} ${prof.surname}`;
  document.getElementById("nameEN").textContent = prof.Eng_name || "";
  document.getElementById("email").textContent = prof.professor_email || "ไม่ระบุอีเมล";
  document.getElementById("major").textContent = prof.Major?.major_name || "ทั่วไป";
  document.getElementById("profileImg").src = prof.img_professor || "img/professor-default.jpg";

  const { data:subs } = await supabaseClient
    .from("professor_subject")
    .select(`Subject ( idsubject, subject_name, idyear )`)
    .eq("idprofessor", idprofessor);

  const subjectsDiv = document.getElementById("subjects");
  if(subs && subjectsDiv) {
      subjectsDiv.innerHTML = subs.length > 0 ? "" : "<p style='color:#888'>ยังไม่มีข้อมูลวิชา</p>";
      subs.forEach(s => {
        if(s.Subject) {
            subjectsDiv.innerHTML += `
              <a href="Allearn_years.html?idyear=${s.Subject.idyear}&target_sub=${s.Subject.idsubject}" class="tag yellow">
                ${s.Subject.subject_name}
              </a>`;
        }
      });
  }
  loadOtherProfessors();
}

async function loadOtherProfessors(){
  const box = document.getElementById("otherProfessorScroll");
  const { data } = await supabaseClient
    .from("Professor")
    .select("idprofessor, name, surname, img_professor")
    .neq("idprofessor", idprofessor)
    .limit(10);

  if(data) {
    box.innerHTML = data.map(p => `
      <a class="professor-link" href="Allearn_professor.html?id=${p.idprofessor}">
        <div class="professor-card-small">
          <img src="${p.img_professor || 'img/professor-default.jpg'}" onerror="this.src='img/professor-default.jpg'">
          <h3>${p.name}<br>${p.surname}</h3>
        </div>
      </a>
    `).join('');
  }
}
</script>

</body>
</html>